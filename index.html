<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TIGASAN - College Task Monitor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Color palette */
    :root {
      --brown-dark: #5a3e36;
      --brown-light: #a67c6f;
      --gray-dark: #333333;
      --gray-medium: #777777;
      --gray-light: #cccccc;
      --black: #000000;
      --white: #ffffff;
    }

    .hidden {
      display: none;
    }
    .fade-in {
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    /* Custom scrollbar */
    .custom-scroll {
      max-height: 150px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--gray-dark) var(--gray-light);
    }
    .custom-scroll::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scroll::-webkit-scrollbar-track {
      background: var(--white);
    }
    .custom-scroll::-webkit-scrollbar-thumb {
      background: var(--gray-light);
      border-radius: 3px;
    }
    /* Calendar grid */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    .day-cell {
      padding: 12px;
      border: 1px solid var(--gray-light);
      background: linear-gradient(135deg, var(--white), #f8fafc);
      cursor: pointer;
      min-height: 70px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
      color: var(--brown-dark);
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .day-cell:hover {
      transform: scale(1.02);
      background: #f0e6e1;
    }
    .day-cell.today {
      background: linear-gradient(135deg, var(--gray-light), var(--gray-medium));
      border: 2px solid var(--brown-dark);
      font-weight: 700;
    }
    .day-cell.agenda {
      background: linear-gradient(135deg, #e6d8d2, #d1c1b7);
      border-color: var(--brown-dark);
    }
    /* Task table */
    .task-table {
      width: 100%;
      border-collapse: collapse;
    }
    .task-table th,
    .task-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--gray-light);
      color: var(--gray-dark);
    }
    .task-table th {
      background: var(--brown-dark);
      color: var(--white);
    }
    /* Leaderboard progress bar */
    .progress-bar {
      background: var(--gray-light);
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-top: 5px;
    }
    .progress-fill {
      height: 100%;
      background: var(--brown-dark);
      transition: width 0.3s;
    }
    /* Modern gradients and shadows */
    .card {
      background: var(--white);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(90, 62, 54, 0.15);
    }
    .btn {
      border-radius: 8px;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(90, 62, 54, 0.4);
      background: var(--brown-light);
      color: var(--white);
      cursor: pointer;
      user-select: none;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(90, 62, 54, 0.6);
      background: var(--brown-dark);
    }
    .btn-red {
      background: #7a3e36;
      color: var(--white);
    }
    .btn-red:hover {
      background: #5a2e26;
    }
    .btn-green {
      background: #6b5b4b;
      color: var(--white);
    }
    .btn-green:hover {
      background: #4a3f33;
    }
    .btn-blue {
      background: var(--brown-light);
      color: var(--white);
    }
    .btn-blue:hover {
      background: var(--brown-dark);
    }
    .header-bg {
      background: linear-gradient(135deg, var(--brown-dark), var(--brown-light));
      color: var(--white);
    }
    .nav-bg {
      background: linear-gradient(135deg, var(--brown-light), var(--brown-dark));
      color: var(--white);
    }
    /* Alert styles */
    .alert {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    .alert-error {
      background: #f5d6d1;
      color: #7a3e36;
    }
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 0 15px;
      }
      .calendar-grid {
        grid-template-columns: repeat(1, 1fr);
      }
      .task-table {
        font-size: 14px;
      }
    }
    /* Leaderboard user image */
    .leaderboard-user-img {
      width: 40px;
      height: 40px;
      border-radius: 9999px;
      object-fit: cover;
      border: 1px solid var(--gray-light);
      margin-right: 0.75rem;
    }
    /* Agenda list flex for delete button */
    #agenda-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #agenda-list li button {
      margin-left: 0.5rem;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
    }
  </style>
</head>
<body class="bg-white font-sans min-h-screen flex flex-col">
  <header class="header-bg p-4 shadow-sm">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold">TIGASAN Task Monitor</h1>
      <button id="logout-btn" class="btn btn-red text-xs px-3 py-1 hidden" onclick="logout()">Logout</button>
    </div>
  </header>

  <div id="login-section" class="flex-grow flex items-center justify-center p-6">
    <div class="card w-full max-w-md text-center">
      <img
        src="logo.jpg"
        alt="Minimalist black and white logo for Circle of Friends Task Monitor"
        class="mx-auto mb-6 rounded-md"
      />
      <h2 class="text-xl font-semibold mb-4 text-primary">Login</h2>
      <input
        id="username-input"
        type="text"
        placeholder="Enter your name"
        class="w-full p-3 border border-gray-400 rounded mb-3 text-primary placeholder-secondary"
      />
      <button onclick="login()" class="btn btn-blue w-full py-3">Login</button>
      <p id="login-error" class="alert-error hidden mt-3 text-sm"></p>
    </div>
  </div>

  <div id="app-section" class="flex-grow hidden">
    <nav class="nav-bg py-3">
      <div class="container mx-auto flex justify-center space-x-4 px-4">
        <button
          id="tasks-tab"
          class="btn text-sm px-3 py-1 border-b-2 border-white"
          onclick="setTab('tasks')"
        >
          Tasks
        </button>
        <button
          id="dashboard-tab"
          class="btn text-sm px-3 py-1 text-gray-300"
          onclick="setTab('dashboard')"
        >
          Dashboard
        </button>
        <button
          id="leaderboard-tab"
          class="btn text-sm px-3 py-1 text-gray-300"
          onclick="setTab('leaderboard')"
        >
          Leaderboard
        </button>
        <button
          id="calendar-tab"
          class="btn text-sm px-3 py-1 text-gray-300"
          onclick="setTab('calendar')"
        >
          Calendar
        </button>
        <button
          id="schedule-tab"
          class="btn text-sm px-3 py-1 text-gray-300"
          onclick="setTab('schedule')"
        >
          Class Schedule
        </button>

        <button id="notes-tab" class="btn text-sm px-3 py-1 text-gray-300" onclick="setTab('notes')">Notes</button>
      </div>
    </nav>

    <main class="container mx-auto p-4 flex-1">
      <div id="tasks-section" class="fade-in">
        <h2 class="text-3xl font-bold mb-6 text-primary">Tasks</h2>
        <div id="admin-task-controls" class="card mb-6 hidden">
          <h3 class="text-lg font-medium mb-4 text-primary">Add/Edit Task</h3>
          <input
            id="new-task-title"
            type="text"
            placeholder="Task Title"
            class="w-full p-2 border border-gray-400 rounded mb-2 text-primary"
          />
          <textarea
            id="new-task-desc"
            placeholder="Task Description (optional)"
            class="w-full p-2 border border-gray-400 rounded mb-3 text-primary"
            rows="3"
          ></textarea>
          <button onclick="addTask()" class="btn btn-green px-4 py-2 mr-2">
            Add Task
          </button>
          <button
            onclick="saveEditTask()"
            class="btn btn-gray px-4 py-2 hidden"
            id="save-edit-btn"
          >
            Save Edit
          </button>
          <button
            onclick="cancelEdit()"
            class="btn btn-gray px-4 py-2 hidden"
            id="cancel-edit-btn"
          >
            Cancel Edit
          </button>
        </div>
        <div id="tasks-list" class="space-y-4"></div>
      </div>

<div id="notes-section" class="hidden fade-in">
  <h2 class="text-3xl font-bold mb-6 text-primary">Notes / Reminders</h2>
  <div class="card">
    <textarea id="notes-textarea" rows="10" class="w-full p-4 border border-gray-400 rounded text-primary" placeholder="Write your notes or reminders here..."></textarea>
    <button onclick="saveNotes()" class="btn btn-blue mt-4 px-6 py-2">Save Notes</button>
    <p id="notes-save-msg" class="text-green-700 mt-2 hidden">Notes saved!</p>
  </div>
</div>
      <div id="dashboard-section" class="hidden fade-in">
        <h2 class="text-3xl font-bold mb-6 text-primary">Dashboard</h2>
        <div id="recent-completions" class="card space-y-3"></div>
      </div>

      <div id="leaderboard-section" class="hidden fade-in">
        <h2 class="text-3xl font-bold mb-6 text-primary">Leaderboard</h2>
        <div id="leaderboard-list" class="space-y-4"></div>
      </div>

      <div id="calendar-section" class="hidden fade-in">
        <h2 class="text-3xl font-bold mb-6 text-primary">Calendar</h2>
        <div class="flex justify-between items-center mb-4">
          <button onclick="changeMonth(-1)" class="btn btn-blue px-3 py-1">
            &larr;
          </button>
          <span id="calendar-title" class="text-lg font-semibold text-primary"></span>
          <button onclick="changeMonth(1)" class="btn btn-blue px-3 py-1">
            &rarr;
          </button>
        </div>
        <div id="calendar-grid" class="calendar-grid mb-4"></div>
        <div id="agenda-controls" class="card hidden">
          <h3 class="text-lg font-medium mb-4 text-primary">Add Agenda</h3>
          <input
            type="date"
            id="agenda-date"
            class="p-2 border border-gray-400 rounded mb-3 text-primary"
          />
          <input
            id="agenda-text"
            type="text"
            placeholder="Agenda Description"
            class="p-2 border border-gray-400 rounded mb-3 mr-2 text-primary"
          />
          <button onclick="addAgenda()" class="btn btn-blue px-4 py-2">
            Add Agenda
          </button>
        </div>
        <div id="agenda-display" class="card hidden">
          <h3 class="text-xl font-semibold mb-4 text-primary">
            Agenda for <span id="agenda-date-display"></span>
          </h3>
          <ul
            id="agenda-list"
            class="list-disc list-inside custom-scroll space-y-1"
          ></ul>
        </div>
      </div>

      <div id="schedule-section" class="hidden fade-in">
        <h2 class="text-3xl font-bold mb-6 text-primary">Class Schedule</h2>
        <div class="card">
          <div id="schedule-table"></div>
        </div>
      </div>
    </main>
  </div>

  <footer class="bg-gray-100 p-4 mt-8 border-t border-gray-300">
    <div class="container mx-auto text-center text-secondary">
      <p>© 2025 Jefferson Padua. All rights reserved. </p>
    </div>
  </footer>

  <script>
    
    // Fixed data
    const users = [
      { username: "jeff", isAdmin: true },
      { username: "aldred", isAdmin: false },
      { username: "ely", isAdmin: false },
      { username: "julie", isAdmin: false },
      { username: "krizza", isAdmin: false },
      { username: "lianne", isAdmin: false },
      { username: "rain", isAdmin: false },
      { username: "rex", isAdmin: false },
      { username: "steven", isAdmin: false },
      { username: "vetina", isAdmin: false },
    ];
    const classScheduleData = [
      {
        code: "CC212-M",
        description: "Data Structures and Algorithms, Lecture",
        lecHours: 2,
        labHours: 0,
        units: 2,
        schedule: "W 07:00AM-09:00AM ONLINE",
      },
      {
        code: "GEC6-M",
        description: "Art Appreciation",
        lecHours: 3,
        labHours: 0,
        units: 3,
        schedule: "M 01:30PM-04:30PM TBA",
      },
      {
        code: "GEC8-M",
        description: "Ethics",
        lecHours: 3,
        labHours: 0,
        units: 3,
        schedule: "F 08:00AM-11:00AM TBA",
      },
      {
        code: "IT211L-M",
        description: "Object Oriented Programming, Laboratory",
        lecHours: 0,
        labHours: 1,
        units: 1,
        schedule: "W 12:00PM-03:00PM ONLINE",
      },
      {
        code: "IT212-M",
        description: "Object Oriented Programming, Lecture",
        lecHours: 2,
        labHours: 0,
        units: 2,
        schedule: "TH 08:00AM-10:00AM COS322",
      },
      {
        code: "IT231L-M",
        description: "Computer Architecture and Organization, Lab",
        lecHours: 0,
        labHours: 1,
        units: 1,
        schedule: "W 04:00PM-05:00PM ONLINE/F 06:00PM-08:00PM ONLINE",
      },
      {
        code: "IT232-M",
        description: "Computer Architecture and Organization, Lec",
        lecHours: 2,
        labHours: 0,
        units: 2,
        schedule: "W 06:00PM-08:00PM ONLINE",
      },
      {
        code: "IT251L-M",
        description: "Platform Technologies, Laboratory",
        lecHours: 0,
        labHours: 1,
        units: 1,
        schedule: "M 05:00PM-08:00PM TBA",
      },
      {
        code: "IT252-M",
        description: "Platform Technologies, Lecture",
        lecHours: 2,
        labHours: 0,
        units: 2,
        schedule: "TH 10:00AM-12:00PM TBA",
      },
      {
        code: "PATHFIT3-M",
        description: "Physical Activity Towards Health and Fitness 3",
        lecHours: 2,
        labHours: 0,
        units: 2,
        schedule: "TH 01:00PM-03:00PM TBA",
      },
      {
        code: "CC211L-M",
        description: "Data Structures and Algorithms, Laboratory",
        lecHours: 0,
        labHours: 1,
        units: 1,
        schedule: "F 11:30AM-02:30PM 328",
      },
      {
        code: "CC211L-M",
        description: "Data Structures and Algorithms, Laboratory",
        lecHours: 0,
        labHours: 1,
        units: 1,
        schedule: "T 07:00AM-10:00AM 328",
      },
    ];

    // Sort class schedule by day: M, T, W, TH, F
    const dayOrder = { M: 0, T: 1, W: 2, TH: 3, F: 4 };
    const classSchedule = classScheduleData.slice().sort((a, b) => {
      const dayA = dayOrder[a.schedule.split(" ")[0]];
      const dayB = dayOrder[b.schedule.split(" ")[0]];
      if (dayA !== dayB) return dayA - dayB;
      return a.schedule.localeCompare(b.schedule);
    });

    // App data
    let currentUser  = null;
    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    let agendas = JSON.parse(localStorage.getItem("agendas")) || {};
    let currentTab = "tasks";
    let currentMonth = new Date();
    let selectedDate = null;

        function init() {
      if (localStorage.getItem("username")) {
        currentUser  = users.find(
          (u) => u.username === localStorage.getItem("username").toLowerCase()
        );
        showApp();
        setTab("tasks");
        loadTasks();
      }
      renderSchedule();
    }

    function loadNotes() {
  if (!currentUser ) return;
  const notesKey = `notes_${currentUser .username}`;
  const savedNotes = localStorage.getItem(notesKey) || "";
  document.getElementById("notes-textarea").value = savedNotes;
  document.getElementById("notes-save-msg").classList.add("hidden");
}
function saveNotes() {
  if (!currentUser ) return;
  const notesKey = `notes_${currentUser .username}`;
  const notes = document.getElementById("notes-textarea").value;
  localStorage.setItem(notesKey, notes);
  const msg = document.getElementById("notes-save-msg");
  msg.classList.remove("hidden");
  setTimeout(() => msg.classList.add("hidden"), 2000);
}
function loadTabContent(tab) {
  if (tab === "tasks") loadTasks();
  else if (tab === "dashboard") loadDashboard();
  else if (tab === "leaderboard") loadLeaderboard();
  else if (tab === "calendar") loadCalendar();
  else if (tab === "notes") loadNotes();
  if (tab === "notes") loadNotes();
  // add other tabs as needed
}
    function login() {
      const username = document
        .getElementById("username-input")
        .value.toLowerCase();
      const errorEl = document.getElementById("login-error");
      currentUser  = users.find((u) => u.username === username);
      if (currentUser ) {
        localStorage.setItem("username", currentUser .username);
        showApp();
        setTab("tasks");
        loadTasks();
        errorEl.classList.add("hidden");
      } else {
        errorEl.textContent = "Invalid username. Please enter a valid name.";
        errorEl.classList.remove("hidden");
      }
    }

    function logout() {
      localStorage.removeItem("username");
      currentUser  = null;
      hideApp();
      setTab("tasks");
      document.getElementById("username-input").value = "";
      document.getElementById("login-error").classList.add("hidden");
    }

    function showApp() {
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("app-section").classList.remove("hidden");
      document.getElementById("logout-btn").classList.remove("hidden");
      // Show admin controls if admin
      document
        .getElementById("admin-task-controls")
        .classList.toggle("hidden", !currentUser .isAdmin);
    }

    function hideApp() {
      document.getElementById("app-section").classList.add("hidden");
      document.getElementById("login-section").classList.remove("hidden");
      document.getElementById("logout-btn").classList.add("hidden");
    }

    function setTab(tab) {
      currentTab = tab;
      const sections = ["tasks", "dashboard", "leaderboard", "calendar", "schedule", "notes"];
      sections.forEach((s) => {
        document.getElementById(s + "-section").classList.toggle("hidden", s !== tab);
        const btn = document.getElementById(s + "-tab");
        if (s === tab) {
          btn.classList.add("border-b-2", "border-white");
          btn.classList.remove("text-gray-300");
        } else {
          btn.classList.remove("border-b-2", "border-white");
          btn.classList.add("text-gray-300");
        }
      });
      loadTabContent(tab);
    }

    function loadTabContent(tab) {
      if (tab === "tasks") loadTasks();
      if (tab === "dashboard") loadDashboard();
      if (tab === "leaderboard") loadLeaderboard();
      if (tab === "calendar") loadCalendar();
      if (tab === "notes") loadNotes();
    }

    function loadTasks() {
      const tasksList = document.getElementById("tasks-list");
      tasksList.innerHTML = tasks
        .map(
          (task) => `
        <div class="card">
          <h3 class="text-xl font-semibold text-primary mb-2">${task.title}</h3>
          <p class="text-secondary mb-3">${task.description || "No description"}</p>
          <p class="text-sm text-secondary mb-3">Completed by: <span class="font-medium">${
            task.doneBy.length ? task.doneBy.join(", ") : "None"
          }</span></p>
          <div class="flex flex-wrap gap-2">
            ${
              currentUser .isAdmin
                ? `
              <button onclick="editTask(${task.id})" class="btn btn-gray">Edit</button>
              <button onclick="deleteTask(${task.id})" class="btn btn-red">Delete</button>
            `
                : ""
            }
            ${
              !task.doneBy.includes(currentUser .username)
                ? `<button onclick="markDone(${task.id})" class="btn btn-green">Mark as Done</button>`
                : '<span class="text-green-600 font-semibold">✔ Completed</span>'
            }
          </div>
        </div>
      `
        )
        .join("");
      document
        .getElementById("admin-task-controls")
        .classList.toggle("hidden", !currentUser .isAdmin);
    }

    function addTask() {
      const title = document.getElementById("new-task-title").value.trim();
      const desc = document.getElementById("new-task-desc").value;
      if (!title) {
        alert("Task title is required.");
        return;
      }
      const id = tasks.length ? tasks[tasks.length - 1].id + 1 : 1;
      tasks.push({ id, title, description: desc, doneBy: [], timestamps: {} });
      saveTasks();
      document.getElementById("new-task-title").value = "";
      document.getElementById("new-task-desc").value = "";
      loadTasks();
      loadLeaderboard();
      setTab("dashboard");
    }

    function editTask(id) {
      const task = tasks.find((t) => t.id === id);
      document.getElementById("new-task-title").value = task.title;
      document.getElementById("new-task-desc").value = task.description;
      document.getElementById("save-edit-btn").classList.remove("hidden");
      document.getElementById("save-edit-btn").setAttribute("data-id", id);
      document.getElementById("cancel-edit-btn").classList.remove("hidden");
    }

    function saveEditTask() {
      const id = parseInt(document.getElementById("save-edit-btn").getAttribute("data-id"));
      const title = document.getElementById("new-task-title").value.trim();
      const desc = document.getElementById("new-task-desc").value;
      if (!title) {
        alert("Task title is required.");
        return;
      }
      const task = tasks.find((t) => t.id === id);
      task.title = title;
      task.description = desc;
      saveTasks();
      cancelEdit();
      loadTasks();
    }

    function cancelEdit() {
      document.getElementById("new-task-title").value = "";
      document.getElementById("new-task-desc").value = "";
      document.getElementById("save-edit-btn").classList.add("hidden");
      document.getElementById("cancel-edit-btn").classList.add("hidden");
      document.getElementById("save-edit-btn").removeAttribute("data-id");
    }

    function deleteTask(id) {
      if (confirm("Are you sure you want to delete this task?")) {
        tasks = tasks.filter((t) => t.id !== id);
        saveTasks();
        loadTasks();
        loadLeaderboard();
      }
    }

    function markDone(id) {
      const task = tasks.find((t) => t.id === id);
      if (!task.doneBy.includes(currentUser .username)) {
        task.doneBy.push(currentUser .username);
        task.timestamps[currentUser .username] = new Date().toISOString();
      }
      saveTasks();
      loadTasks();
      loadDashboard();
      loadLeaderboard();
    }

    function loadDashboard() {
      let completions = [];
      tasks.forEach((task) => {
        for (const user of task.doneBy) {
          completions.push({
            username: user,
            taskTitle: task.title,
            timestamp: task.timestamps[user],
          });
        }
      });
      completions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      const recent = completions.slice(0, 10);
      document.getElementById("recent-completions").innerHTML = recent.length
        ? recent
            .map(
              (c) => `
          <div class="bg-f9f9f9 p-3 rounded border border-gray-200">
            <p class="font-medium text-primary">${c.username}</p>
            <p class="text-secondary">Completed "${c.taskTitle}"</p>
            <p class="text-xs text-secondary">at ${formatTime(c.timestamp)}</p>
          </div>
        `
            )
            .join("")
        : '<p class="text-secondary">No recent task completions.</p>';
    }

    function formatTime(iso) {
      const d = new Date(iso);
      return d.toLocaleString();
    }

    function loadLeaderboard() {
      const total = tasks.length;
      if (total === 0) {
        document.getElementById("leaderboard-list").innerHTML =
          '<div class="text-center text-secondary">No tasks available for leaderboard.</div>';
        return;
      }
      const lbs = users
        .map((u) => {
          const done = tasks.filter((t) => t.doneBy.includes(u.username)).length;
          const percent = ((done / total) * 100).toFixed(2);
          return { user: u, percent: parseFloat(percent) };
        })
        .sort((a, b) => b.percent - a.percent);
      document.getElementById("leaderboard-list").innerHTML = lbs
        .map(
          (l, i) => `
        <div class="card flex items-center justify-between">
          <div class="flex items-center">
            <span class="text-lg font-bold text-primary mr-3">${i + 1}</span>
            <img src="https://via.placeholder.com/40?text=${l.user.username.charAt(
              0
            ).toUpperCase()}" alt="${l.user.username}" class="leaderboard-user-img" />
            <span class="font-medium text-primary">${l.user.username}</span>
            ${
              l.user.isAdmin
                ? '<span class="ml-2 px-2 py-1 bg-gray-200 text-secondary text-xs rounded-full">Admin</span>'
                : ""
            }
          </div>
          <div class="text-right min-w-0 flex-1">
            <div class="font-semibold text-primary">${l.percent}%</div>
            <div class="progress-bar w-full max-w-32">
              <div class="progress-fill" style="width: ${Math.min(l.percent, 100)}%"></div>
            </div>
          </div>
        </div>
      `
        )
        .join("");
    }

    function loadCalendar() {
      renderCalendar();
      toggleAgendaControls(!currentUser .isAdmin);
    }

    function renderCalendar() {
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const title = currentMonth.toLocaleString("default", { month: "long", year: "numeric" });
      document.getElementById("calendar-title").textContent = title;
      const firstDay = new Date(year, month, 1).getDay();
      const lastDay = new Date(year, month + 1, 0).getDate();
      const grid = [];
      for (let i = 0; i < firstDay; i++) grid.push("");
      for (let d = 1; d <= lastDay; d++) grid.push(d.toString());
      const today = new Date().getDate();
      const monthStr = (month + 1).toString().padStart(2, "0");
      document.getElementById("calendar-grid").innerHTML = grid
        .map((day) => {
          if (!day) return '<div class="day-cell"></div>';
          const d = parseInt(day);
          const date = `${year}-${monthStr}-${d.toString().padStart(2, "0")}`;
          const hasAgenda = agendas[date] && agendas[date].length > 0;
          const isToday = d === today && month === new Date().getMonth() && year === new Date().getFullYear();
          return `
            <div class="day-cell ${isToday ? "today" : ""} ${hasAgenda ? "agenda" : ""}" onclick="selectDate('${date}')">
              <div class="font-medium text-primary">${d}</div>
              ${
                hasAgenda
                  ? `<div class="w-2 h-2 bg-gray-500 rounded-full mt-2 mx-auto" title="Agenda scheduled"></div>`
                  : ""
              }
            </div>
          `;
        })
        .join("");
    }

    function changeMonth(delta) {
      currentMonth.setMonth(currentMonth.getMonth() + delta);
      renderCalendar();
    }

    function selectDate(date) {
      selectedDate = date;
      if (currentUser .isAdmin) {
        document.getElementById("agenda-date").value = date;
        showAgendas(date);
        document.getElementById("agenda-controls").classList.remove("hidden");
        document.getElementById("agenda-display").classList.remove("hidden");
      } else {
        showAgendas(date);
        document.getElementById("agenda-controls").classList.add("hidden");
        document.getElementById("agenda-display").classList.remove("hidden");
      }
    }

    function addAgenda() {
      const date = document.getElementById("agenda-date").value;
      const text = document.getElementById("agenda-text").value.trim();
      if (!text) {
        alert("Agenda description is required.");
        return;
      }
      if (!agendas[date]) agendas[date] = [];
      agendas[date].push(text);
      saveAgendas();
      document.getElementById("agenda-text").value = "";
      renderCalendar();
      showAgendas(date);
      setTab("dashboard");
    }

    function showAgendas(date) {
      const agendaListEl = document.getElementById("agenda-list");
      document.getElementById("agenda-date-display").textContent = date;
      const agendaItems = agendas[date] || [];
      if (agendaItems.length === 0) {
        agendaListEl.innerHTML = '<li class="text-secondary">No agendas scheduled.</li>';
      } else {
        agendaListEl.innerHTML = agendaItems
          .map((agenda, index) => {
            if (currentUser .isAdmin) {
              return `
                <li class="text-secondary flex justify-between items-center">
                  <span>${agenda}</span>
                  <button onclick="deleteAgenda('${date}', ${index})" class="btn btn-red px-2 py-1 text-xs ml-2">Delete</button>
                </li>
              `;
            } else {
              return `<li class="text-secondary">${agenda}</li>`;
            }
          })
          .join("");
      }
    }

    function deleteAgenda(date, index) {
      if (confirm("Are you sure you want to delete this agenda item?")) {
        agendas[date].splice(index, 1);
        if (agendas[date].length === 0) {
          delete agendas[date];
        }
        saveAgendas();
        showAgendas(date);
        renderCalendar();
      }
    }

    function toggleAgendaControls(hide) {
      document.getElementById("agenda-controls").classList.toggle("hidden", hide);
      document.getElementById("agenda-display").classList.toggle("hidden", true);
    }

    function renderSchedule() {
      const tableRows = classSchedule
        .map(
          (item) => `
        <tr class="hover:bg-gray-50">
          <td class="font-medium text-primary">${item.code}</td>
          <td class="text-secondary">${item.description}</td>
          <td class="text-center text-secondary">${item.lecHours}</td>
          <td class="text-center text-secondary">${item.labHours}</td>
          <td class="text-center text-secondary">${item.units}</td>
          <td class="text-secondary">${item.schedule}</td>
        </tr>
      `
        )
        .join("");
      document.getElementById("schedule-table").innerHTML = `
        <table class="w-full task-table bg-white rounded-lg overflow-hidden shadow-sm">
          <thead>
            <tr>
              <th>Subject Code</th>
              <th>Description</th>
              <th class="text-center">Lec Hours</th>
              <th class="text-center">Lab Hours</th>
              <th class="text-center">Credit Units</th>
              <th>Schedule</th>
            </tr>
          </thead>
          <tbody>${tableRows}</tbody>
        </table>
      `;
    }
    

    function saveTasks() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
    }

    function saveAgendas() {
      localStorage.setItem("agendas", JSON.stringify(agendas));
    }

    init();
  </script>
</body>
</html>
